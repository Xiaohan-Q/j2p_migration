# Java to Python Migration Tool

一个功能完整的 Java → Python 代码自动迁移工具,支持解析、语义映射、代码生成和验证。

## 功能模块

### 1. **ast_parser** - Java 代码解析器
- 使用 `javalang` 库解析 Java 代码
- 提取类、方法、字段、构造函数等结构信息
- 支持继承、接口、泛型等复杂特性

### 2. **semantic_mapper** - 语义映射器
- Java 类型 → Python 类型映射 (如 `String` → `str`)
- 泛型类型映射 (如 `List<String>` → `List[str]`)
- 修饰符映射 (如 `static` → `@staticmethod`)
- Python 命名约定转换 (如常量大写、私有方法下划线前缀)

### 3. **migration_planner** - 迁移策略规划器
- 分析代码复杂度
- 生成详细的迁移步骤计划
- 识别潜在问题并给出警告
- 提供迁移建议

### 4. **code_generator** - Python 代码生成器
- 根据映射结构生成格式化的 Python 代码
- 自动添加类型注解
- 生成标准的 Python 代码结构
- 支持保存到文件

### 5. **validator** - 迁移结果验证器
- 语法验证
- 结构完整性检查
- 命名规范验证
- 类型注解检查
- 静态代码分析 (flake8)
- 代码执行测试

## 安装

```bash
# 克隆项目
cd j2p_migration

# 安装依赖
pip install -r requirements.txt
```

## 使用方法

### 命令行使用

```bash
# 基本用法 - 迁移单个文件
python src/main.py -i example.java -o example.py

# 显示详细的迁移计划
python src/main.py -i example.java --show-plan

# 跳过验证步骤
python src/main.py -i example.java -o example.py --no-validate

# 详细输出模式
python src/main.py -i example.java -o example.py -v

# 输出到控制台 (不保存文件)
python src/main.py -i example.java
```

### Python API 使用

```python
from ast_parser import JavaASTParser
from semantic_mapper import SemanticMapper
from code_generater import PythonCodeGenerator
from validator import MigrationValidator

# Java 代码
java_code = """
public class Person {
    private String name;
    private int age;

    public Person(String name, int age) {
        this.name = name;
        this.age = age;
    }

    public String getName() {
        return name;
    }
}
"""

# 步骤 1: 解析 Java 代码
parser = JavaASTParser()
java_structure = parser.get_full_structure(java_code)

# 步骤 2: 语义映射
mapper = SemanticMapper()
python_structure = mapper.map_structure(java_structure)

# 步骤 3: 生成 Python 代码
generator = PythonCodeGenerator()
python_code = generator.generate_code(python_structure)

# 步骤 4: 验证
validator = MigrationValidator()
report = validator.validate_migration(java_code, python_code, python_structure)
validator.print_report(report)

# 输出结果
print(python_code)
```

## 项目结构

```
j2p_migration/
├── src/
│   ├── ast_parser.py          # Java AST 解析器
│   ├── semantic_mapper.py     # 语义映射器
│   ├── migration_planner.py   # 迁移策略规划器
│   ├── code_generater.py      # Python 代码生成器
│   ├── validator.py           # 验证器
│   └── main.py                # 主程序入口
├── test/
│   └── test_conversion.py     # 测试用例
├── requirements.txt           # 依赖文件
└── README.md                  # 本文件
```

## 运行测试

```bash
# 运行所有测试
pytest test/test_conversion.py -v

# 运行特定测试类
pytest test/test_conversion.py::TestJavaParser -v

# 查看测试覆盖率
pytest test/test_conversion.py --cov=src --cov-report=html
```

## 示例

### 输入 (Java)

```java
public class Calculator {
    private static final double PI = 3.14159;

    public int add(int a, int b) {
        return a + b;
    }

    public static double circleArea(double radius) {
        return PI * radius * radius;
    }
}
```

### 输出 (Python)

```python
"""
自动从 Java 代码迁移生成
Generated by Java to Python Migration Tool
"""
from typing import Dict, List, Any, Optional

class Calculator:
    """Java 类 Calculator 的 Python 实现"""

    PI: float = 3.14159

    def add(self, a: int, b: int) -> int:
        """TODO: 实现方法体"""
        pass

    @staticmethod
    def circleArea(radius: float) -> float:
        """TODO: 实现方法体"""
        pass
```

## 功能特性

✅ 类和方法结构转换
✅ 字段和构造函数映射
✅ 类型系统转换 (基本类型、泛型、数组)
✅ 修饰符映射 (static, private, final 等)
✅ 命名约定转换
✅ 类型注解生成
✅ 继承和接口支持
✅ 导入语句映射
✅ 代码验证和质量检查
✅ 详细的迁移计划和建议

⚠️ **注意**: 方法体的逻辑转换需要手动完成或进一步开发 AST 节点转换功能

## 限制和已知问题

1. **方法体转换**: 当前版本只转换方法签名,方法体需要手动迁移
2. **复杂表达式**: 不支持复杂的 Java 表达式自动转换
3. **异常处理**: try-catch 语句需要手动调整为 try-except
4. **包管理**: Java 包系统与 Python 模块系统的映射需要手动处理
5. **第三方库**: Java 库到 Python 库的映射需要手动查找替代品

## 未来改进

- [ ] 支持方法体语句级别的转换
- [ ] 支持 Java 表达式到 Python 表达式的映射
- [ ] 添加常用 Java 库到 Python 库的映射数据库
- [ ] 支持批量文件迁移
- [ ] 生成迁移报告 (HTML/PDF)
- [ ] GUI 界面
- [ ] 增量迁移支持

## 贡献

欢迎提交 Issue 和 Pull Request!

## 许可证

MIT License
